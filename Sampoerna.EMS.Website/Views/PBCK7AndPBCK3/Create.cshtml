@{
    ViewBag.Title = "Create";
}

@using (Html.BeginForm("Create", "PBCK7AndPBCK3"))
{
    <div class="container-wrap title-page">
        <div class="row">
            <div class="col-sm-12">
                <h3>PBCK-3</h3>
                <label class="status">Draft</label>
                <h3>PBCK-7</h3>
                <label class="status">Draft</label>
                <div class="action-button">
                    <button class="btn btn-blue">Save</button>
                    <button class="btn btn-grey">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-wrap">
        <div class="row">
            <div class="col-sm-12">
                <div role="tabpanel">

                    <!-- Nav tabs -->
                    @Html.AntiForgeryToken()
                    <ul role="tablist" class="nav nav-tabs">
                        <li class="active" id="tab-information" role="presentation"><a data-toggle="tab" role="tab" aria-controls="information" href="#information">Information</a></li>
                        <li role="presentation" ><a data-toggle="tab" role="tab" aria-controls="printout" href="#printout">Print Out</a></li>
                        <li role="presentation" id="tab-upload" ><a data-toggle="tab" role="tab" aria-controls="upload" href="#upload">Upload</a></li>
                        @*<li role="presentation"><a data-toggle="tab" role="tab" aria-controls="changes" href="#changes">Changes Log</a></li>*@
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        @Html.Partial("_HomeCreate")
                        @Html.Partial("_PrintOut")
                        @Html.Partial("_Upload")
                    </div>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts{
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/Scripts/jquery.form.min.js"></script>
    <script src="~/Scripts/UploadExcel.js"></script>
    <script type="text/javascript">
        $('#btn-generate-upload').click(function() {
            uploadXmlFile();
        });
        $('#btn-save-upload').click(function() {
            $('#table-upload').html('');
            $('#table-upload').html($('#table-upload-preview').html());
            $('#tab-upload').removeClass('active');
            $('#tab-information').addClass('active');
            $('#tab-information').children()[0].click();
        });

        function toUploadTab() {
            $('#tab-information').removeClass('active');
            $('#tab-upload').addClass('active');
            $('#tab-upload').children()[0].click();
           
        }

        function uploadXmlFile() {

            var postUrl = '@Url.Action("UploadFile", "PBCK7AndPBCK3")';
            var fileName = $('[name="itemExcelFile"]').val().trim();
            var pos = fileName.lastIndexOf('.');
            var extension = (pos <= 0) ? '' : fileName.substring(pos);
            if (extension != '.xlsx') {
                alert('Please browse a correct excel file to upload');
                return false;
            }

            var formData = new FormData();
            var totalFiles = document.getElementById("itemExcelFile").files.length;
            for (var i = 0; i < totalFiles; i++) {
                var file = document.getElementById("itemExcelFile").files[i];
                formData.append("itemExcelFile", file);
                formData.append("plantId", "ID01");

            }
            $.ajax({
                type: "POST",
                url: postUrl,
                data: formData,
                dataType: 'html',
                contentType: false,
                processData: false,

                success: function(response) {
                    $('#UploadLIst').html('');
                    $('#UploadLIst').html(response);
                    $('#btn-save-upload').enable();
                }
            });
        }

        ;
    </script>
}